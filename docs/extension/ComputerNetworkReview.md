# 计算机网络总结

计算机网络的知识点总结，主要基于"计算机网络(第7版)"书籍进行学习总结。也包含学习过程中的一些实践案例。

## Docs
- "计算机网络(第7版)" 谢希仁
- "HTTP权威指南" 古尔利(Gourley, D)
- [What is a computer network?(IBM)](https://www.ibm.com/topics/networking#What+is+a+computer+network%3F)
- [计算机网络(JavaScript Guidebook)](https://tsejx.github.io/javascript-guidebook/computer-networks)

## 计算机网络基础概念

理解基础性的概念，才能理解技术发展的缘由，才能更好区分各项技术的作用。参考这篇文档进行笔记，[What is a computer network?(IBM)](https://www.ibm.com/topics/networking#What+is+a+computer+network%3F)。

### 关键概念概览
- 计算机网络
    > 两台及两台以上的计算机组成的网络，称为计算机网络。
- 计算机网络目的
    > 计算机网络里的设备可以进行传输、交换或共享数据和资源。
- 计算机网络构建方式
    > 硬件 + 软件
    > 
    > 使用硬件（例如，路由器、交换机、接入点和电缆）和软件（例如，操作系统或业务应用程序）构建计算机网络。
- 计算机网络类型
    > 主要是根据网络覆盖区域的范围进行分类。常见有八种，具体参考[计算机网络类型](./ComputerNetworkReview#计算机网络类型)。
- IP地址
    > IP地址是给计算机网络中的每个设备的分配唯一编号。
    > 
    > IP地址作用
    > - IP 地址标识设备的主机网络以及设备在主机网络上的位置。
    > 
    > IP地址使用场景
    > - IP地址使用在用 Internet 协议进行通信计算机网络中。IP地址是唯一的，但是IP地址与设备的关系也是可分配的关系。
    >
    > IP地址使用方式
    > - 当一个设备向另一设备发送数据时，数据包含一个“标头”，其中包含发送设备的 IP 地址和目标设备的 IP 地址。
- 节点
    > 节点是网络内可以接收、发送、创建或存储数据的连接点。节点本质上是任何可以识别、处理信息并将信息传输到任何其他网络节点的网络设备。
    > 
    > 每个节点都要求您提供某种形式的标识才能接收访问权限，例如 IP 地址。
    > 
    > 节点的一些示例包括`计算机`、`打印机`、`调制解调器`、`网桥`和`交换机`。
- 路由器
    > 路由器是在网络之间发送数据包中包含的信息的物理或虚拟设备。
    > 
    > 路由器作用: 分析数据包、确定下一个路由、转发数据包
    > - 路由器分析数据包中的数据，以确定信息到达最终目的地的最佳方式。路由器转发数据包直到到达目的地节点。
- 交换机
    > 交换机是连接其他设备并管理网络内节点到节点通信的设备，确保数据包到达最终目的地。
    >
    > 交换机和路由器区别 
    > - 路由器在网络之间发送信息，而交换机在单个网络中的节点之间发送信息。
- 交换方式
    > "switching"交换是指数据如何在网络中的设备之间传输。有三种方式，详情可查看[交换方式](./ComputerNetworkReview#交换方式)。
- 端口
    > 端口标识网络设备之间的特定连接。每个端口都由一个数字标识。
    >
    > 计算机使用端口号来确定哪个应用程序、服务或进程应接收特定消息。通常搭配IP地址一起使用。
- 网络电缆类型
    > 最常见的网络电缆类型是以太网双绞线、同轴电缆和光纤。
    >
    > 电缆类型的选择取决于网络的规模、网络元件的布置以及设备之间的物理距离。
- 互联网
    > 互联网是一个连接全球数十亿数字设备的网络网络。标准协议允许这些设备之间进行通信。
- 互联网服务提供商(ISP)
    > 互联网服务提供商(ISP)是提供允许通过互联网传输数据包或信息的基础设施。它是协议和基础设施的结合，可以准确地告诉信息的去向。
- 网络服务提供商(NSP)
    > 网络服务提供商(NSP)是提供允许通过互联网传输数据包或信息的基础设施。它是协议和基础设施的结合，可以准确地告诉信息的去向。
- [计算机网络如何工作](./ComputerNetworkReview#计算机网络如何工作)
- [计算机网络架构](./ComputerNetworkReview#计算机网络架构)
- [网络拓扑](./ComputerNetworkReview#网络拓扑)
- 网络安全策略
    > 网络安全策略的目的是为了平衡了向用户提供服务的需求和控制信息访问的需求。
- [网状网络类型](./ComputerNetworkReview#网络拓扑)
- 负载均衡器
    > 负载均衡器可在可用服务器之间有效分配任务、工作负载和网络流量。
    > 
    > 负载均衡器观察进入网络的所有流量，并将其引导至最适合管理它的路由器或服务器。
    >
    > 负载平衡的目标是避免资源过载、优化可用资源、缩短响应时间并最大化吞吐量。
- 内容交付网络(CDN)
    > 内容交付网络(CDN)是一种分布式服务器网络，可根据用户的地理位置向用户交付临时存储或缓存的网站内容副本。
    >
    > CDN 将此内容存储在分布式位置并将其提供给用户，以此缩短网站访问者与网站服务器之间的距离。CDN 通过在最终用户和网站基础设施之间引入一个层来防止流量激增、减少延迟、减少带宽消耗、加快加载时间并减轻黑客和攻击的影响。

## 计算机网络如何工作
计算器网络的目的是为了网络里的设备可以传输、交换或共享数据和资源。

所以在计算机网络中的每次数据传输的通讯都是一次工作流程，而支撑通讯的内容就是计算机网络如何工作的内容。

### 数据传输通讯的需求分析
以电话线通讯为参考，思考可能的需求，两者是具有相似性的。主要分为硬件层次和软件层次的需求假设。
- 物理设备需求
    - 使用电缆、光纤或无线信号连接计算机、路由器和交换机等节点
    - 这些连接允许网络中的设备进行通信并共享信息和资源。提供了物理基础。
- 中间转发设备需求
    > 在物理基础上进行传输，需要有多个中间节点作为转发。
    - 路由器分析信息以确定数据到达最终目的地的最佳方式。
    - 交换机连接设备并管理网络内的节点到节点通信，确保通过网络传输的信息包到达最终目的地。
    - 这些设备提供了转发的基础.
- 在设备基础，需要一些软件层次的发送、接收、转发的协议和规范实现数据的流通
    - 网络遵循协议，协议定义了如何发送和接收通信。
    - 这些协议允许设备进行通信。网络上的每个设备都使用 Internet 协议或 IP 地址，这是唯一标识设备并允许其他设备识别它的一串数字。 


## 计算机网络架构
[计算机网络架构定义了计算机网络的物理和逻辑框架。它概述了计算机在网络中的组织方式以及分配给这些计算机的任务。网络架构组件包括硬件、软件、传输介质（有线或无线）、网络拓扑和通信协议。](https://www.ibm.com/topics/networking#Architecture)

计算机网络架构主要分为P2P、C/S两类。

### P2P(peer-to-peer)(对等连接)
网络中的每台计算机既是client也是server。

P2P 网络不需要中央服务器进行协调。网络上的每台计算机既充当客户端（需要访问服务的计算机）又充当服务器（满足客户端访问服务的需求的计算机）。每个对等点都将其部分资源提供给网络，共享存储、内存、带宽和处理能力。

### C/S(client/server)(客户端/服务端)
网络中存在中央服务器，统筹管理客户端的访问。

中央服务器或服务器组管理资源并向网络中的客户端设备提供服务。网络中的客户端通过服务器与其他客户端进行通信。与 P2P 模型不同，客户端/服务器架构中的客户端不共享资源。这种体系结构类型有时称为分层模型，因为它是采用多个级别或层设计的。

## 网络拓扑
网络拓扑是指网络中节点和链路的排列方式。

有多种拓扑结构，但最常见的是总线型、环形型、星型型和网状型。
- 总线型
    > 有多个节点构成的一条网络主线，每个网络节点直接连接到主线上。
- 环形型
    > 节点以环路连接，因此每个设备恰好有两个邻居。相邻对直接相连，非相邻对通过多个节点间接连接。
- 星型型
    > 所有节点都连接到单个中央集线器，并且每个节点都通过该集线器间接连接。
- 网状型
    > 节点之间的重叠连接定义。您可以创建全网状拓扑，其中网络中的每个节点都连接到每个其他节点。您还可以创建部分网状拓扑，其中仅部分节点相互连接，部分节点连接到与其交换最多数据的节点。
    > 
    > 网状网络有两种类型：全网状和部分网状。

## 计算机网络类型
- LAN (local area network) 局域网
    > - 范围较小，距离较短的计算机网络
    > - 局域网可以连接办公楼、学校或医院中的所有计算机。通常，局域网是私人拥有和管理的。
- WLAN (wireless local area network) 无线局域网
    > - WLAN 就像 LAN，但网络上的设备之间的连接是通过无线方式进行的
- WAN (wide area network) 广域网
    > - 大范围的计算机网络
    > - 例如从一个地区到另一个地区，甚至从一个大陆到另一个大陆。互联网是最大的广域网，连接全球数十亿台计算机。您通常会看到用于 WAN 管理的集体或分布式所有权模型。
- MAN (metropolitan area network) 城域网
    > - MAN 通常大于 LAN，但小于 WAN。城市范围级别的计算机网络。
    > - 城市和政府实体通常拥有和管理城域网。
- PAN (personal area network) 个域网
    > - 最小的计算机网络，单个人周围的设备组成的网络。
    > - 如果您有一台 iPhone 和一台 Mac，您很可能已经设置了一个 PAN。
- SAN (storage area network) 存储区域网络
    > - SAN 是一种专用网络，访问存储服务（共享网络或云存储）的计算机网络。
    > - 对于用户来说，SAN 的外观和工作方式类似于物理连接到计算机的存储驱动器。
- CAN (campus area network) 校园局域网
    > - CAN 比 LAN 大，但比 WAN 小。企业园区范围级别的计算机网络。
    > - CAN 为学院、大学和商业园区等场所提供服务。
- VPN (virtual private network) 虚拟专用网络
    > - 范围比较小，VPN 是两个网络端点之间的安全点对点连接。
    > - 侧重点不是范围大小，而是连接的安全性较高。VPN 建立一个加密通道，使用户的身份和访问凭证以及传输的任何数据都无法被黑客访问。

网络覆盖区域比较大小
- WAN > MAN > CAN > LAN = WLAN

## 交换方式
在讨论计算机网络时，"switching"是指数据如何在网络中的设备之间传输。主要有三种交换方式，常用的是分组交换技术。

存储转发技术
- 在这三种方式中，Packet switching和Message switching对数据做了拆分传输和存储的处理，即采用了`存储转发技术`。

(Packet switching和Message switching)交换过程中不同单位的数据之间关系
- 整块数据 = 报文(Message)
- 拆分报文(Message) = 数据包(data packets)
- 数据包(data packets) + 首部(header)(必要的控制信息) = 分组(packet)

### 电路交换(Circuit switching)
转发的是报文，但是通过建立连按来保证通信时所需的各种资源。不需要使用存储转发技术处理。

整个报文的比特流连续地从源点直达终点，好像在一个管道中传送。

### 数据包交换(Packet switching)(分组交换)
转发的是分组报文，使用了存储转发技术。

单个分组 (这只是整个报文的一部分)传送到相邻结点，存储下来后查找转发表，转发到下一个结点。

### 消息交换(Message switching)(报文交换)
转发的是报文，使用了存储转发技术。

整个报文先传送到相邻结点，全部存储下来后查找转发表，转发到下一个结点。

## 计算机网络体系结构
- [计算机网络体系](https://tsejx.github.io/javascript-guidebook/computer-networks/computer-network-architecture/computer-networks)

计算机网络的各层及其协议的集合就是网络的体系结构(architecture)。目前世界广泛使用的的是TCP/IP四层模型。
> - 计算机网络体系分层需要处理的问题，"计算机网络(第7版)" P29

### OSI七层模型
国际标准化组织ISO提出的开放系统互连基本参考模型OSI/RM (Open Syster s Interconnection Reference Model)。该模型是法律上的国际标准。

不过由于TCP/IP四层模型普及更早，通用型更好。所以TCP/IP四层模型是事实上的国际标准。

七层结构
> - [OSI七层结构](https://tsejx.github.io/javascript-guidebook/computer-networks/computer-network-architecture/computer-networks#osi-%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B)
- 应用层：允许访问 OSI 环境的手段（应用协议数据单元 APDU）
- 表示层：对数据进行翻译、加密和压缩（表示协议数据单元 PPDU）
- 会话层：建立、管理和终止会话（会话协议数据单元 SPDU）
- 传输层：提供端到端的可靠报文传递和错误恢复（段 Segment）
- 网络层：负责数据包从源到宿的传递和网际互连（包 PackeT）
- 数据链路层：将比特组装成帧和点到点的传递（帧 Frame）
- 物理层：通过媒介传输比特,确定机械及电气规范（比特 Bit）

### TCP/IP四层模型
TCP/IP四层模型是事实上的国际标准。只有四层，一般在学习原理阶段可以扩展五层。

- 应用层(application layer)
    - 应用层的任务是通过应用进程问的交互来完成特定网络应用。
    - 交互的数据单元
        - 报文(mesage)
    - 常见协议
        - 域名系统 DNS
        - 支持万维网应用的 HTTP 协议
        - 支持电子邮件的 SMTP 协议，
- 运输层(transport layer)
    - 运输层的任务就是负责向两台主机中进程之间的通信提供通用的数据传输服务。应用进程利用该服务传送应用层报文。主要有两种传输协议(TCP、UDP)
    - 交互的数据单元
        - TCP -> 报文段(segment)
        - UDP -> 用户数据报
    - 常见协议
        - 传输控制协议 TCP (Transmision Control Protocol)
        - 用户数据报协议 UDP (User Datagram Protocol)-
- 网络层(network layer)
    - 网络层负责为分组交换网上的不同主机提供通信服务。在发送数据时，网络层把运输层产生的报文段或用户数据报封装成分组或包进行传送。
    - 交互的数据单元
        - IP 数据报
    - 常见协议
        - 网际协议IP (Internet Protocol)
- 网络接口层
    - 数据链路层(data link layer)
        - 数据链路层常简称为链路层。我们知道，两台主机之间的数据传输，总是在一段一段的链路上传送的，这就需要使用专门的链路层的协议。数 据链路层将网络层交下来的IP数据报组装成帧(framing)，在两个相邻结点间的链路上传送帧(frame) 
        - 交互的数据单元
            - 帧(frame)
    - 物理层(physical laver)
        - 在物理层上所传数据的单位是比特。
        - 交互的数据单元
            - 比特(bit)
## 网络协议
这些为进行网络中的数据交换而建立的规则、标准或约定称为网络协议(network protocol)。网络协议也可简称为协议。

网络协议组成(三个要素)
- 语法，即数据与控制信息的结构或格式。
- 语义，即需要发出何种控制信息，完成何种动作以及做出何种响应。
- 同步，即事件实现顺序的详细说明。

## TCP协议
> - 传输控制协议TCP概述 "计算机网络(第7版)" P29

### TCP报文段的首部
> 首部的作用在交换方式中提到，是在报文转发过程中用于作为控制信息的。

!["tcp-1"](/img/docs/networkreview/tcp-1.png "tcp-1")


### 首部固定部分各字段的意义(高频)
> 其中保留后面6个单词表示控制位，用于说明本报文段的性质。

- 序号(Seq)
    > “报文段序号”，首部中的序号字段值则指的是本报文段所发送的数据的第一个字节的序号。
- 确认号(Ack)
    > 期望收到对方下一个报文段的第一个数据字节的序号。
    >
    > 一般用于核对交换报文的“序号”是否一致。
- 确认ACK(ACKnowledgment)
    > 仅当ACK=1时确认号字段才有效。当ACK=0时确认号字段无效。
    > 
    > 在建立连接之后所有传送的报文段ACK=1。
- 同步SYN(SYNchronization)
    > 在连接建立时用来同步序号。SYN置为1就表示这是一个连接请求或连接接受报文。
    >
    > - SYN=1、ACK=0 这是一个连接请求报文。
    > - SYN=1、ACK=1 这是一个连接接受报文。
- 终止FIN(FINis)
    > 用来释放一个连接。
    >
    > 当FIN=1时，表明此报文段的发送方的数据己发送完毕，并要求释放运输连接。

### TCP运输连接管理阶段
> 运输连接管理有以下三个阶段。

- 连接建立
- 数据传输
- 连接释放

### TCP三次握手
TCP三次握手指的是三次报文交换，完成TCP连接建立过程。

!["tcp-2"](/img/docs/networkreview/tcp-2.png "tcp-2")

#### 小结
TCP三次握手，就是客户端和服务端，两端通过三次报文完成连接建立的过程。

客户端向服务端进行两次报文，一次请求连接建立，一次确认建立连接报文。而服务端只发送一次报文给客户端，既是请求连接建立也是响应请求的报文。

> 未建立连接时，客户端状态(默认) -> CLOSED、服务端状态(默认) -> CLOSED
1. 第一次报文
    - SYN报文，SYN=1，Seq=x
    - 客户端发送服务端，请求建立连接报文
    - 客户端状态(发送成功) -> SYN-SENT、服务端状态(接收成功) -> LISTEM
2. 第二次报文
    - ACK报文，ACK=1，Ack=x+1，SYN=1，Seq=y
    - 服务端发送客户端，响应请求建立连接报文并请求建立连接
    - 服务端状态(发送成功) -> SYN-RCVD
3. 第三次报文
    - ACK报文，ACK=1，Ack=y+1，Seq=x+1
    - 客户端状态(发送成功) -> ESTABLISHED、服务端状态(接收成功) -> ESTABLISHED

### TCP四次挥手
TCP四次挥手指的是四次报文交换，完成TCP连接释放过程。数据传输结束后，通信的双方都可释放连接。

!["tcp-3"](/img/docs/networkreview/tcp-3.png "tcp-3")

#### 小结
TCP四次握手，就是客户端和服务端，两端通过四次报文完成连接断开的过程。而数据传输结束后，通信的双方都可释放连接。

所以这里的总结案例的场景是客户端(A)主动申请断开连接。连接断开是具有方向性的，比如客户端确认断开，那么客户端就不再主动发送数据报文出去。

四次握手断开连接，就是主动请求方(A)和被动处理方(B)都发起一次申请断开的报文，和确认连接断开的报文。不过是主动请求方(A)方向先断开连接，然后才是被动处理方(B)的方向断开连接。请求断开的报文特点就是使用了FIN控制位。

主动请求方(A)还会在TIME-WAIT(时问等待计时器)状态等待2MSL(4分钟)时间后，才彻底进行CLOSED。
> 时间MSL叫做最长报文段寿命(Maximum Segment Lifetime)，RFC 793 建议设为2分钟。

> 未断开连接时，客户端状态(默认) -> ESTABLISHED、服务端状态(默认) -> ESTABLISHED
1. 第一次报文
    - FIN报文，SYN=1，Seq=u
    - 客户端发送服务端，请求断开连接报文
    - 客户端状态(发送成功) -> FIN-WIAT-1
2. 第二次报文
    - ACK报文，ACK=1，Ack=u+1，SYN=1，Seq=v
    - 服务端发送客户端，响应断开建立连接报文.
    - 服务端状态(发送成功) -> CLOSED-WAIT，客户端状态(接收成功) -> FIN-WAIT-2
3. 第三次报文
    - FIN报文，ACK=1，Ack=u+1，SYN=1，Seq=w
    - 服务端发送客户端，请求断开建立连接报文.
    - 服务端状态(发送成功) -> LASK-ACK
4. 第四次报文
    - ACK报文，ACK=1，Seq=u+1,Ack=w+1
    - 客户端发送服务端，响应断开连接报文
    - 客户端状态(发送成功) -> TIME-WAIT、服务端状态(接收成功) -> CLOSED
    - 等待2MSL后，客户端状态-> CLOSED

### 高频问题集
- 为什么三次握手客户端最后还要发送一次确认呢？
为了防止己失效的连接请求报文段突然又传送到了服务端，因而产生错误。

- 为什么四次握手后，主动断开方在TIME-WAIT状态必须等待2MSL 的时问呢?
1. 主动断开方，在2MSL时间阶段会持续重传FIN + ACK 报文段，帮助被动处理方进入CLOSED状态。是为了避免报文丢失的情况。

- 为什么四次握手断开连接，比三次握手建立连接多一次握手？
主要的区别在于被动打开方的请求和确认报文，在三次握手里其实是一起发出去的，也是可以拆开的。合并的目的是SYN（Synchronize）和ACK（Acknowledgment）可以在同一个报文段中一起发送，这是为了减少通信的往返时间并提高连接建立的效率。

而断开连接的时候为什么必须为四次，是因为FIN报文表示某个方向的数据报文已经发送完成，需要进行释放连接，不允许再发送数据报文了。所以被动关闭方需要先发送确认报文，然后再发送FIN报文请求释放连接，并等待主动关闭方的确认报文。

这个目的也是为了确保全双工通信的可靠性，顺利完成连接的断开，避免报文丢失产生资源空耗的情况。

## WWW(万维网)
> - "计算机网络(第7版)" P264

### WWW相关基础概念
- WWW是什么
    > 万维网WWW(World Wide Web)并非某种特殊的计算机网络。万维网是一个大规模的、联机式的信息储藏所，英文简称为Web。
    >
    > 从系统层面讲，WWW是一个分布式的超媒体(hypermedia)系统，它提供分布式服务。位于计算机网络架构应用层。
    > 
    > 万维网以客户服务器方式工作。万维网文档所驻留的主机则运行服务器程序，因此这台主机也称为万维网服务器。客户程序向服务器程序发出请求，服务器程序向客户程序送回客户所要的万维网文档。

### WWW的问题和解决办法
WWW的作用是主机间能够在万维网信息库中，主动地按需获取丰富的信息。需要解决一如下系列问题。
- 怎样标志分布在整个互联网上的万维网文档? -> [统一资源定位符URL(UniformResourceLocator)](./ComputerNetworkReview#url)
- 用什么样的协议来实现万维网上的各种链接? -> [超文本传送协议HTTP(HyperText Transfer Protocol)](./ComputerNetworkReview#http)
- 怎样使不同作者创作的不同风格的万维网文档，都能在互联网上的各种主机上显示出来，同时使用户清楚地知道在什么地方存在着链接? -> 超文本标记语言HTML(HyperText Markup Language)
- 怎样使用户能够很方便地找到所需的信息? -> 搜索引擎(爬虫、SEO)

### WWW工作过程
!["www-1"](/img/docs/networkreview/www-1.png "www-1")

## URL
> - "HTTP权威指南" P26
> - "计算机网络(第7版本)" P266
> - 统一资源定位符URL(UniformResourceLocator)

### URL是什么
统一资源定位符 URL 是用来表示从互联网上得到的资源位置和访问这些资源的方法。

URL给资源的位置提供一种抽象的识别方法，并用这种方法给资源定位。

### URL的规则
URL的基本语法主要是有由以下四个部分组成`<协议>://<主机>:<端口>/<路径>`，URL里面的字母不分大小写。

URL的完成通用语法有九种部分组成
```
<scheme>://<user>:<password>@<host›:<port>/<path»;<params>?<guery›#<frag>
```
!["url-1"](/img/docs/networkreview/url-1.png "url-1")

### URL、URI、URN的区别
- URI是一类更通用的资源标识符，URL实际上是它的一个子集。URI是一个通用的概念，由两个主要的子集URL和URN构成。
- URL是通过描述资源的位置来标识资源的。
- URN则是通过名字来识别资源的，与它们当前所处位置无关。

## HTTP
> 超文本传送协议HTTP(HyperText Transfer Protocol)

### Docs
- [http(javascript-guidebook)](https://tsejx.github.io/javascript-guidebook/computer-networks/http/http)
- [（建议精读）HTTP灵魂之问，巩固你的 HTTP 知识体系](https://juejin.cn/post/6844904100035821575#heading-11)
- [计算机网络面试题（含解答）2022版](https://zhuanlan.zhihu.com/p/471948799)

### HTTP协议是什么
HTTP 协议定义了浏览器(即万维网客户进程)怎样向万维网服务器请求万维网文档，以及服务器怎样把文档传送给浏览器。HTTP不仅传送完成超文本跳转所必需的信息，而且也传送任何可从互联网上得到的信息，如文本、超文本、声音和图像等。

HTTP现在默认标准版本是HTTP1.1。

HTTP协议特点
- 无状态
    > 没有机制让服务器保留与上次HTTP请求的对话。不会去识别已经接受过同一个请求方的HTTP请求。
- 可靠传输
    > 使用了面向连接的TCP作为运输层协议，保证了数据的可靠传输。但通信的双方在交换HTTP报文之前不需要先建立HTTP连接。

### HTTPS协议是什么
HTTPS 经由 HTTP 进行通信，但利用SSL/TLS来加密数据包。HTTPS 开发的主要目的，是提供对网站服务器的身份认证，保护交换数据的隐私与完整性。

### HTTP协议和HTTPS协议区别
- HTTP和HTTPS默认的端口号不同：HTTP 80，HTTPS 443。
- HTTPS需要用到CA（数字证书认证机构）申请证书，一般需要一定费用。
- HTTPS在HTTP协议基础上使用到了SSL/TLS。因此会占用服务器资源，会加大连接建立的资源消耗。
- HTTP报文存储明文信息，HTTPS报文存储加密信息。
- SSL/TLS是一套加密传输的协议。

### HTTP通讯过程
HTTP通信过程其实可以理解就是[浏览器工作原理的流程部分](./WebPerformance#浏览器的工作原理)。

不过需要注意的是，导航部分本质上就是HTTP请求发起的部分，不过是先建立TCP连接和TLS通道之后才发送请求内容的包。更详细流程可以查看[WWW工作过程](./ComputerNetworkReview#WWW工作过程)。

这里的TLS通道建立是在HTTPS写一下才需要处理的，如果是HTTP协议则不需要。

[浏览器工作原理](./WebPerformance#浏览器的工作原理)
1. [导航](./WebPerformance#导航)
2. [DNS查询](./WebPerformance#dns查询)
3. [TCP握手](./WebPerformance#tcp握手)
4. [TLS协商](./WebPerformance#tls协商)
5. [响应](./WebPerformance#响应)
6. [解析(Parsing)](./WebPerformance#解析)
7. [渲染(Render)](./WebPerformance#渲染)
8. [交互](./WebPerformance#交互)

### HTTP常用状态码

HTTP 状态码被分成了五大类，以不同数字开头。
- 1xx 表示通知信息，如请求收到了或正在进行处理。
- 2xx 表示成功，如接受或知道了。
- 3xx 表示重定向，如要完成请求还必须采取进一步的行动。
- 4xx 表示客户的差错，如请求中有错误的语法或不能完成。
- 5xx 表示服务器的差错，如服务器失效无法完成请求。

常用状态码
- 200
- 301
- 304
- 400
- 403
- 404
- 405
- 500
- 501
- 502
- 503

### HTTP长连接和短连接区别
长短连接的区别是指在HTTP请求结束后，TCP连接是否需要保持连接。长连接表示要求保持连接，短连接表示当HTTP请求结束，那么TCP连接也要断开。

长连接的好处是在需要持久传输的场景，可以避免重复创建TCP连接，增加服务器资源消耗。坏处是，在客户端不持久传输的场景，如果连接保持会浪费服务器资源。

在不同HTTP版本中对于长短连接的默认处理是不同的
- HTTP1.0
    > - 默认关闭长连接。
    > - 使用keep-alive连接处理来开启长连接。在Header增加以下两个请求头。
    >   - Connection: Keep-Alive // 开启长连接
    >   - Keep-Alive: max=5, timeout=120 // 可选，长连接配置max=最大事务、timeout=打开状态持续时间
- HTTP1.1
    > - 默认开启长连接，但是不是以keep-alive连接方式来处理的。
    > - 如果想关闭长连接。在Header增加以下请求头
    >   - Connection: close

### HTTP的缓存
web缓存是可以自动保存常见文档副本的HTTP设备。当web请求抵达级存时， 如果本地有“己缓存的” 副本，就可以从本地存储设备而不是原始服务器中提取这个文档。

缓存相关概念
- 缓存命中(cache hit)
    > 用已有的副本为某些到达缓存的请求提供服务。
- 緩存未命中(cache miss)
    > 其他一些到达缓存的请求可能会由于没有副本可用，而被转发给原始服务器。
- HTTP再验证(revalidation)
    > 新鲜度检测
    - 再验证命中(revalidate hit)
        > - 缓慢命中(slow hit)
        > - 如果服务器对象未被修改，服务器会向容户端发送一个小的HTTP 304 Not Modified响应。
    - 再验证未命中
        > 如果服务器对象与已缓存副本不同，服务器向客户端发送一条普通的、带有完整内容的HTTP 200 OK响应。
    - 对象被删除
        > 如果服务器对象已经被删除了，服务器就回送一个404 Not Found响应，缓存也会将其副本删除。

!["http-1"](/img/docs/networkreview/http-1.png "http-1")

缓存控制Header
> 由服务器添加缓存控制Header。
- Cache-Control
    - max-age 
        > max-age首部表示的是从服务器将文档传来之时起，可以认为此文档处于新鲜状态的秒数。
- Expires
    > 不推荐使用Expires首部，它指定的是实际的过期日期而不是秒数。
```
Cache-Control: max-age=3600 
Expires: Fri, 05 Jul 2002, 05:00:00 GMT
```

缓存再验证
> 由服务器添加缓存在验证Header。
- If-Modified-Since
    > If-Moditied-Since: `<date>`，data指资源上次修改时间。
    > - 如果修改日期未发生变化，再验证返回304响应。
    > - 如果修改日期已发生变化，再验证返回200响应。
- If-None-Match
    > If-None-Match: `<tags>`，tags指资源的标识。
    > - 如果实体标签仍然匹配，If-None-Match再验证成功，再验证返回304响应。
    > - 如果实体标签不匹配，If-None-Match再验证失败，再验证返回200响应和新的`<tags>`。


缓存的处理步骤
!["http-2"](/img/docs/networkreview/http-2.png "http-2")

缓存的处理步骤解析
其实就是先进行一次本地缓存是否过期的对比，然后去服务端进行服务缓存是否过期的对比。最后决定是使用就缓存还是服务器下发新缓存。

这两次对比就是两次的缓存处理
- 强缓存
    > - 确认浏览器缓存是否过期
    > - 比较缓存控制Header，Cache-Control或者Expires
    > - 未过期返回200，过期就进入协商缓存流程。
- 协商缓存
    > - 通过本地缓存和服务端缓存，来确认是否过期。
    > - 有两种header，If-Moditied-Since和If-None-Match，比较方式不一样。
    > - 如果未过期，返回304，如果过期返回200，重新更新缓存。

### POST和GET的区别
- POST和GET都是HTTP方法
- 方法作用不同
    - GET常用于请求服务器发送某个资源。
    - POST常用与想服务器发送数据，执行服务动作。
- 数据存储方式不同
    - GET的数据只能拼接在URL上。
    - POST的数据可以存储在请求体中。
- 缓存效果不同
    - GET的请求响应数据会被浏览器缓存。
    - POST的请求响应数据不会被浏览器缓存。

### Cookie和Session区别
- cookie是客户端保持状态的方法
    > 存储由服务器发至客户端并由客户端保存的一段字符串保存与Set-Cookie Header。用于保持会话。但是用户的状态数据存储与客户端。
- session是服务器保持状态的方法
    > 为每个用户有一个独一无二的Session ID作为Session文件的Hash键，通过这个值可以锁定具体的Session结构的数据。服务端需要保存用户状态数据。

### HTTP1.0、HTTP1.1、HTTP2的区别
- [一文总结http1.0，http1.1，http2，http3，面试强心剂](https://zhuanlan.zhihu.com/p/469988032?utm_medium=social&utm_oi=1089297405844787200)

> 其实目前主要使用HTTP1.1，主要比较1.1和1.0的两个区别，一个是增加了缓存处理，一个是使用了默认的长连接。

http1.0
- HTTP1.0最早在网页中使用是在1996年，那个时候只是使用一些较为简单的网页上和网络请求上,是一种无状态、无连接的应用层协议

http1.1
- http1.1基于文本解析，把所有请求和响应作为纯文本。
- http1.1加入了`缓存处理`（强缓存和协商缓存）
- http1.1拥有`长连接`，并支持请求管道化（pipelining），
- http1.1流控制基于tcp连接。当连接建立时，两端通过系统默认机制建立缓冲区。并通过ack报文来通知对方接收窗口大小，因为http1.1 依靠传输层来避免流溢出，每个tcp连接需要一个独立的流控制机制

http2.0
- http2相比于http1.1，性能大幅度提升
- http2通过一个连接来多路复用
- http2拥有头部压缩
- http2拥有新的二进制格式，使用二进制框架层把所有消息封装成二进制，且仍然保持http语法
- http2允许客户端和服务器端实现他们自己的流控制机制，而不是依赖传输层,两端在传输层交换可用的缓冲区大小，来让他们在多路复用流上设置自己的接收窗口
- http2让服务器可以将响应主动“推送”到客户端缓存中

## DNS
> - "计算机网络(第7版)" P250

### DNS相关基础概念
- 域名(domain name)
    > 任何一个连接在互联网上的主机或路由器，都有一个唯一的层次结构的名字，即域名(domain name)。
- “域” (domain) 
    > “域”(domain)是名字空间中一个可被管理的划分。域还可以划分为子域，而子域还可继续划分为子域的子域，这样就形成了顶级域、二级域、三级域，等等。 
- DNS的产生
    > 在1983年互联网就开始采用层次树状结构的命名方法，并使用分布式的域名系统DNS。DNS的互联网标准是RFC1034, 1035。
- DNS的作用
    > 域名系统DNS(Domain Name System)，DNS的作用是能够把互联网上的主机名字解析为IP地址，并返还给查询主机。
- DNS的工作原理
    > 域名到 IP 地址的解析，是由分布在互联网上的许多`域名服务器程序` (可简称为`域名服务器`)，共同完成的。每次解析查询采用的都是UDP报文。
- 域名服务器
    > `域名服务器程序`在专设的结点上运行，而人们也常把运行`域名服务器程序`的机器称为`域名服务器`。
- 区(zone)
    > 一个服务器所负责管辖的(或有权限的)范围叫做区(zone)。出现区的原因是域名服务器的数量太多，过于分散导致解析效率低。因此DNS就采用划分区的办法解决这个问题。
    >
    > DNS服务器的`管辖范围`不是以`“域”`为单位，而是以`“区”`为单位。
- 权限域名服务器(authoritative name server)
    > 各单位根据具体情况来划分自己管辖范围的区。但在一个区中的所有节点必须是能够连通的。所以每一个区设置相应的`权限域名服务器(authoritative name server)`，用来保存该区中的所有主机的域名到卫地址的映射。
- 高速缓存域名服务器
    > 高速缓存用来存放最近查询过的域名以及从何处获得域名映射信息的记录。在域名服务器中广泛地使用。目的是为了提高DNS查询效率，并减轻根域名服务器的负荷和减少互联网上的DNS查询报文数量。

### 互联网的域名结构
互联网上的DNS域名服务器也是按照层次安排的，每一个域名服务器都只对域名体系中的一部分进行管辖。

根据域名服务器所起的作用，可以把域名服务器划分为以下四种不同的类型。

- 根域名服务器(root name server)
    > 根域名服务器是最高层次的域名服务器，也是最重要的域名服务器。所有的根域名服务器都知道所有的顶级域名服务器的域名和IP地址。
- 顶级域名服务器 (即 TLD 服务器)
    > 这些域名服务器负责管理在该顶级域名服务器注册的所有二级域名。当收到DNS查询请求时，就给出相应的回答(可能是最后的结果，也可能是下一步应当找的域名服务器的IP 地址)
- 权限域名服务器
    > 一个区的域名服务器。
- 本地域名服务器(local name server)
    > 本地域名服务器(默认域名服务器)并不属于的域名服务器层次结构，但它对域名系统非常重要。
    > 
    > 当一台主机发出 DNS 查询请求时，这个查询请求报文就发送给本地域名服务器。
    >
    > 每一个互联网服务提供者ISP，或一个大学，甚至一个大学里的系，都可以拥有一个本地域名服务器，这种域名服务器有时也称为默认域名服务器。

!["dns-1"](/img/docs/networkreview/dns-1.png "dns-1")

### DNS查询方式
#### 递归查询(recursive query)
> 主机向本地域名服务器的查询一般都是采用递归查询(recursive query)。

1. 主机所询问的本地域名服务器查询域名的IP地址
2. 如果主机所询问的本地域名服务器不知道被查询域名的IP地址，那么本地域名服务器就以DNS客户的身份，向其他根域名服务器继续发出查询请求报文(即替该主机继续查询)，而不是让该主机自己进行下一步的查询。
    > 递归查询返回的查询结果或者是所要查询的DP地址，或者是报错，表示无法查询到所需的IP地址。

#### 迭代查询(iterative query)
> 本地域名服务器向根域名服务器的查询通常是采用迭代查询(iterative query)。

1. 本地域名服务器向根域名服务器发出迭代查询请求报文 
2. 当根域名服务器收到本地域名服务器发出的迭代查询请求报文时
    1. 要么给出所要查询的IP地址
    2. 要么返回下一个可查询域名服务器。
        > 告诉本地域名服务器:“你下一步应当向哪一个域名服务器进行查询”。然后让本地域名服务器进行后续的查询(而不是替本地域名服务器进行后续的查询)。

### DNS解析过程
> 这里的所有术语词都是指具体的某台主机、具体的某层级域名服务器。简写只是为了方便理清流程。另外这里的解析是不考虑缓存的情况而执行的完整查询路径。

1. `主机`向其`本地域名服务器`进行递归查询。
2. `本地域名服务器`采用迭代查询，向一个`根域名服务器`查询。
3. `根域名服务器`告诉`本地域名服务器`，下一次应查询的`顶级域名服务器`的IP地址。
4. `本地域名服务器`向`顶级域名服务器`进行查询。
5. `顶级域名服务器`告诉`本地域名服务器`，下一次应查询的`权限域名服务器`的IP地址。
6. `本地域名服务器`向`权限域名服务器`进行查询。
7. `权限域名服务器`告诉`本地域名服务器`，所查询的`主机`的IP地址。
8. `本地域名服务器`最后把查询结果告诉`主机`

解析总结
- 这8个步骤总共要使用8个UDP用户数据报的报文。
- 主机向本地域名服务器使用递归查询，本地域名服务器作为主机代理向多层次域名服务器进行迭代查询，最终把目的主机IP返回给查询主机。
- 一般情况下是不需要8个步骤的，因为DNS具有高速缓存机制，如果域名服务器是高速缓存域名服务器，那么就可以减少部分不必要的查询请求。

### DNS高速缓存机制
高速缓存用来存放最近查询过的域名以及从何处获得域名映射信息的记录。在域名服务器中广泛地使用。

高速缓存域名服务器优点
- 提高DNS查询效率
- 并减轻根域名服务器的负荷和减少互联网上的DNS查询报文数量

高速缓存域名服务器工作原理
- 域名服务器可以直接将域名对应的上次查询结果IP地址返回查询方。
- 如果本地域名服务器的缓存中并没有目的主机的IP地址，而是存放着对应顶级域名服务器的IP地址，那么本地域名服务器也可以不向根域名服务器进行查询，而是直接向对应顶级域名服务器发送查询请求报文
- 为保持高速缓存中的内容正确，域名服务器应为每项内容设置计时器并处理超过合理时间的项(例如，每个项目只存放两天)